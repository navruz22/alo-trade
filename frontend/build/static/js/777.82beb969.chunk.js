"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[777],{4777:function(e,n,l){l.r(n),l.d(n,{default:function(){return k}});var s=l(4942),r=l(9439),t=l(2791),a=l(71),i=l(184),d=function(e){var n=e.offer,l=e.user,s=e.changeOffer,r=null===l||void 0===l?void 0:l._id,t=n.order,d=n.product,o=n.messages,c=n.createdAt,u=n.offererUser,m=t?t.name:d?d.name:"",x=o.message,f=o.isRead,v=o.user,h=t?t.images[0]:d?d.images[0]:null,p=u._id===r,g=v!==(null===l||void 0===l?void 0:l._id)&&!f;return(0,i.jsxs)("div",{onClick:s,className:"bg-white flex items-center hover:bg-grey-lighter cursor-pointer flex-row border-b pl-3",children:[(0,i.jsx)("div",{children:h?(0,i.jsx)("img",{alt:"alotrade.uz",className:"h-12 w-12 rounded-full",src:h}):(0,i.jsx)("div",{className:"h-12 w-12 rounded-full border-dashed bg-neutral-200 flex items-center justify-center",children:"IMG"})}),(0,i.jsxs)("div",{className:"ml-4 flex-1 py-4 pr-2",children:[(0,i.jsxs)("div",{className:"flex items-bottom justify-between",children:[(0,i.jsx)("p",{className:"text-neutral-500 font-amazonbold h-6 overflow-hidden",children:m}),(0,i.jsx)("p",{className:"text-xs text-neutral-600",children:new Date(c).toLocaleDateString()})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("p",{className:"text-neutral-500 mt-1 text-sm h-6 overflow-hidden",children:x&&x}),g&&(0,i.jsx)("p",{className:"text-[10px] bg-green-500 px-2 text-red-600 rounded-md ",children:"new"}),(0,i.jsx)("p",{className:"text-xs text-neutral-600",children:p?(0,i.jsx)(a.uiN,{size:15,className:"rotate-45"}):(0,i.jsx)(a.xW6,{size:15,className:"rotate-45"})})]})]})]})},o=l(763),c=function(e){var n,l,s,r,t,d,c=e.data,u=e.translations;if(!c)return null;var m=null===c||void 0===c?void 0:c.organization,x=null===c||void 0===c?void 0:c.user,f=m?u.tashkilot+": "+(null===m||void 0===m?void 0:m.name):u.foydalanuvchi+": "+(null===x||void 0===x?void 0:x.firstname)+" "+(null===x||void 0===x?void 0:x.lastname);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{className:"font-amazonbold py-2 text-lg border-y border-neutral-300",children:f}),(0,i.jsx)("h3",{className:"font-amazonbold py-1",children:null===c||void 0===c?void 0:c.name}),(0,i.jsx)("h4",{className:"py-2 mb-2",children:null===c||void 0===c?void 0:c.description}),(0,i.jsxs)("p",{className:"flex items-center text-neutral-600 text-sm",children:[(0,i.jsx)("span",{className:"mr-2",children:(0,i.jsx)(a.kXE,{})}),(0,i.jsxs)("span",{children:[null===c||void 0===c||null===(n=c.region)||void 0===n?void 0:n.name,", ",null===c||void 0===c||null===(l=c.district)||void 0===l?void 0:l.name]})]}),(0,i.jsxs)("p",{className:"flex items-center text-neutral-600 text-sm",children:[(0,i.jsx)("span",{className:"mr-2",children:(0,i.jsx)(a.Ty1,{})}),(0,i.jsx)("span",{children:(null===c||void 0===c||null===(s=c.organization)||void 0===s?void 0:s.phone)||(null===c||void 0===c||null===(r=c.user)||void 0===r?void 0:r.phone)})]}),(0,i.jsxs)("p",{className:"flex items-center text-neutral-600 text-sm",children:[(0,i.jsxs)("span",{className:"pr-2 font-amazonbold",children:[u.savdo_turi,":"," "]})," ",(0,i.jsx)("span",{children:(null===c||void 0===c?void 0:c.tradetypes)&&(0,o.map)(null===c||void 0===c?void 0:c.tradetypes,(function(e){return(null===e||void 0===e?void 0:e.name)+", "}))})]}),(0,i.jsxs)("p",{className:"flex items-center text-neutral-600 text-sm",children:[(0,i.jsxs)("span",{className:"pr-2 font-amazonbold",children:[u.kategoriya,":"," "]})," ",(0,i.jsx)("span",{children:(null===c||void 0===c?void 0:c.categories)&&(0,o.map)(null===c||void 0===c?void 0:c.categories,(function(e){return(null===e||void 0===e?void 0:e.name)+", "}))})]}),(0,i.jsxs)("p",{className:"flex items-center text-neutral-600 text-sm",children:[(0,i.jsxs)("span",{className:"pr-2 font-amazonbold",children:[u.kategoriya_turi,":"," "]})," ",(0,i.jsx)("span",{children:(null===c||void 0===c?void 0:c.subcategories)&&(0,o.map)(null===c||void 0===c?void 0:c.subcategories,(function(e){return(null===e||void 0===e?void 0:e.name)+", "}))})]}),(0,i.jsxs)("p",{className:"flex items-center justify-between text-neutral-600 text-lg py-2 my-2 border-y border-neutral-300",children:[(0,i.jsxs)("span",{className:"pr-2 font-amazonbold",children:[u.narxi,": "]})," ",(0,i.jsxs)("span",{className:"text-amber-500 font-amazonbold ",children:[null!==c&&void 0!==c&&c.minPrice?(null===c||void 0===c||null===(t=c.minPrice)||void 0===t?void 0:t.toLocaleString("ru-RU"))+" - ":""," ",null===c||void 0===c||null===(d=c.maxPrice)||void 0===d?void 0:d.toLocaleString("ru-RU")," ",null===c||void 0===c?void 0:c.currency]})]}),(0,i.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(null===c||void 0===c?void 0:c.images)&&(0,o.map)(null===c||void 0===c?void 0:c.images,(function(e){return(0,i.jsx)("div",{className:"w-full flex items-center justify-center rounded bg-white-900 ",children:(0,i.jsx)("img",{className:"",alt:"alotrade",src:e})},(0,o.uniqueId)("productImage"))}))})]})},u=function(e){var n=e.message,l=n.message,s=n.user,r=n.createdAt;return(0,i.jsxs)("div",{className:"w-full flex flex-row my-3",children:[(0,i.jsx)("div",{className:" w-16 flex justify-center items-center",children:null!==s&&void 0!==s&&s.image?(0,i.jsx)("img",{src:s.image,alt:"Alotarade",className:"w-12 h-12 rounded-full"}):(0,i.jsxs)("div",{className:"w-12 h-12 rounded-full uppercase flex items-center justify-center bg-white-900",children:[null===s||void 0===s?void 0:s.firstname[0],null===s||void 0===s?void 0:s.lastname[0]]})}),(0,i.jsxs)("div",{className:"w-2/3 bg-white-900 rounded shadow-md px-2",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsxs)("h3",{className:"font-amazonbold text-neutral-500 text-[15px]",children:[null===s||void 0===s?void 0:s.firstname," ",null===s||void 0===s?void 0:s.lastname]}),(0,i.jsxs)("p",{className:"text-[12px] text-neutral-500 text-end",children:[new Date(r).toLocaleTimeString().slice(0,5)," ",new Date(r).toLocaleDateString()]})]}),(0,i.jsx)("p",{className:"text-neutral-600",children:l})]})]})},m=function(e){var n=e.message,l=n.message,s=n.user,r=n.createdAt;return(0,i.jsxs)("div",{className:"w-full flex flex-row my-3 justify-end",children:[(0,i.jsxs)("div",{className:"w-2/3 bg-white-900 rounded shadow-md px-2",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsxs)("h3",{className:"font-amazonbold text-neutral-500 text-[15px]",children:[null===s||void 0===s?void 0:s.firstname," ",null===s||void 0===s?void 0:s.lastname]}),(0,i.jsxs)("p",{className:"text-[12px] text-neutral-500 text-end",children:[new Date(r).toLocaleTimeString().slice(0,5)," ",new Date(r).toLocaleDateString()]})]}),(0,i.jsx)("p",{className:"text-neutral-600",children:l})]}),(0,i.jsx)("div",{className:" w-16 flex justify-center items-center",children:null!==s&&void 0!==s&&s.image?(0,i.jsx)("img",{src:s.image,alt:"Alotarade",className:"w-12 h-12 rounded-full"}):(0,i.jsxs)("div",{className:"w-12 h-12 rounded-full uppercase flex items-center justify-center bg-white-900",children:[null===s||void 0===s?void 0:s.firstname[0],null===s||void 0===s?void 0:s.lastname[0]]})})]})},x=l(9169),f=l(3168),v=function(e){var n=e.changeHandler,l=e.enterHandler,s=e.sendHandler,r=e.value,t=(0,f.$)().t,d=(0,x.F)(t).xabarni_kiriting;return(0,i.jsxs)("div",{className:"bg-white-900 w-full h-[5rem] px-10 py-5 flex",children:[(0,i.jsx)("input",{value:r,onKeyUp:l,onChange:n,placeholder:d,className:"border rounded-l w-full py-1 px-3 outline-0"}),(0,i.jsx)("button",{onClick:s,className:"px-3 border-r border-y text-neutral-500 rounded-r",children:(0,i.jsx)(a.yhK,{})})]})},h=l(9434),p=l(7689),g=l(8285),j=l(6691),w=l(2106),N=l(9917),b=(0,l(2317).ZP)("http://185.107.237.60/"),y=JSON.parse(localStorage.getItem("_grecaptcha"));b.auth={token:y};var _=b,k=function(){var e=(0,h.I0)(),n=(0,p.TH)(),l=(0,f.$)(["common"]).t,a=(0,x.F)(l),b=(0,t.useRef)(null),y=(0,h.v9)((function(e){return e.login})).userData.user,k=(0,h.v9)((function(e){return e.offers})),S=k.offers,z=k.messages,U=(0,t.useState)(null),D=(0,r.Z)(U,2),I=D[0],Z=D[1],C=(0,t.useState)(null),E=(0,r.Z)(C,2),H=E[0],L=E[1],q=(0,t.useState)(null),R=(0,r.Z)(q,2),T=R[0],A=R[1],F=(0,t.useState)(null),P=(0,r.Z)(F,2),M=P[0],O=P[1],K=(0,t.useState)(""),Q=(0,r.Z)(K,2),$=Q[0],G=Q[1],J=(0,t.useState)(null),V=(0,r.Z)(J,2),W=V[0],X=V[1],B=(0,t.useState)(null),Y=(0,r.Z)(B,2),ee=Y[0],ne=Y[1],le=function(e){var n=e.target.name;ne(n===ee?null:e.target.name)},se=function(){if(0===$.length)return(0,w.Ug)("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043d\u0435 \u0432\u0432\u0435\u0434\u0435\u043d\u043e","warning");if(!T&&!M)return(0,w.Ug)(a.mahsulot_yoki_buyurtma_tanlanmagan,"warning");var n={message:$,product:T?T._id:void 0,order:M?M._id:void 0,offer:W?W._id:void 0};e(W?(0,N.tn)(n):(0,N.Cm)(n)).then((function(e){var n=e.error,l=e.payload,s=l.offer,r=l.message;n||(G(""),X(s),re({recipient:null===r||void 0===r?void 0:r.recipient}))}))},re=function(e){var n=e.recipient;_.emit("sendMessage",{recipient:n})};return(0,t.useEffect)((function(){!function(){var e;null===(e=b.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[z]),(0,t.useEffect)((function(){_.on("error",(function(e){var n=e.id,l=e.message;y._id===n&&(0,w.Ug)(l,"error")})),_.on("newMessage",(function(n){var l=n.recipient===y._id;l&&e((0,N.Rg)()),l&&W&&e((0,N.Qi)({id:W._id})).then((function(n){n.error||e((0,N.jd)({id:W._id}))}))}))}),[y,e,W]),(0,t.useEffect)((function(){if(n.state){var l=n.state.type,r=n.state.id;Z(r),L(l);var t=(0,s.Z)({},l,r);e((0,N.qU)(t)).then((function(n){var l=n.error,s=n.payload.offer;l||(X(s),!s&&e((0,N.nT)({messages:[]})))}))}else e((0,N.nT)({messages:[]})),O(null),A(null)}),[n.state,e]),(0,t.useEffect)((function(){I&&("product"===H&&e((0,g.D)({id:I})).then((function(e){var n=e.error,l=e.payload.product;n||(O(null),A(l))})),"order"===H&&e((0,j.nF)({id:I})).then((function(e){var n=e.error,l=e.payload.order;n||(A(null),O(l))})))}),[I,H,e]),(0,t.useEffect)((function(){e((0,N.Rg)({filter:ee}))}),[e,ee,y]),(0,t.useEffect)((function(){W&&e((0,N.Qi)({id:W._id})).then((function(n){n.error||e((0,N.jd)({id:W._id}))}))}),[e,W]),(0,i.jsxs)("div",{className:"flex flex-row h-full w-full ",children:[(0,i.jsxs)("div",{className:"max-w-[400px] min-w-[300px] w-1/4 h-full flex flex-col",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{onClick:le,name:"offererUser",className:"w-1/2 py-2 ".concat("offererUser"===ee?"bg-primary-700":"bg-primary-800"," text-white-900 border-r border-white-900"),children:a.chiquvchi_xabar}),(0,i.jsx)("button",{onClick:le,name:"user",className:"w-1/2 py-2 ".concat("user"===ee?"bg-primary-700":"bg-primary-800"," text-white-900"),children:a.kiruvchi_xabar})]}),(0,i.jsx)("div",{className:"h-full w-full overflow-scroll px-3",children:(0,o.map)(S,(function(e){return(0,i.jsx)(d,{changeOffer:function(){return function(e){e.order&&(L("order"),Z(e.order._id)),e.product&&(e.product&&L("product"),e.product&&Z(e.product._id)),X(e)}(e)},user:y,offer:e},(0,o.uniqueId)("chatUser"))}))})]}),(0,i.jsxs)("div",{className:"h-full w-1/2 relative bg-neutral-200 flex flex-col",children:[(0,i.jsxs)("div",{className:"h-full overflow-scroll",children:[(0,o.map)(z,(function(e){return(null===(n=e.user)||void 0===n?void 0:n._id)===(null===y||void 0===y?void 0:y._id)?(0,i.jsx)(m,{message:e},(0,o.uniqueId)("message")):(0,i.jsx)(u,{message:e},(0,o.uniqueId)("message"));var n})),(0,i.jsx)("div",{className:"",ref:b})]}),(0,i.jsx)(v,{value:$,changeHandler:function(e){G(e.target.value)},enterHandler:function(e){"Enter"===e.key&&se()},sendHandler:se})]}),(0,i.jsx)("div",{className:"max-w-[400px] min-w-[300px] w-1/4 h-full overflow-scroll p-4 bg-neutral-100",children:(0,i.jsx)(c,{data:T||M,translations:a})})]})}}}]);
//# sourceMappingURL=777.82beb969.chunk.js.map